swagger: "2.0"
info:
  description: "API REST que sirve como una interfaz unificada para el proyecto Destinatarios de ANF. Brinda acceso a métodos para interectuar con la base de datos y obtener, modificar e insertar datos referentes a los Destinatarios. También permite ejecutar los diferentes Scanners para extraer información desde los diferentes sitios web registrados."
  version: "0.3.9"
  title: "API DESTINATARIOS"
#  termsOfService: "http://anf.es/api/destinatarios/terms/"
#  contact:
#    email: "anf@anf.es"
#  license:
#    name: "Apache 2.0"
#    url: "http://www.apache.org/licenses/LICENSE-2.0.html"
#host: "localhost:8080"
host: "destinatarios-test.anf.es"
basePath: "/"
tags:
- name: "Admin"
  description: "Operaciones de adinistración"
- name: "Destinatarios"
  description: "Operaciones relacionadas con los Destinatarios"
- name: "Mails"
  description: "Operaciones relacionadas con los Emails"
- name: "Scanners"
  description: "Ejecución de los diferentes Scanners"
schemes:
- "https"
- "http"
securityDefinitions:
  basicAuth:
    type: basic
security:
  - basicAuth: []
paths:
  /admin/version:
    get:
      tags:
      - "Admin"
      summary: "Versión de la API y de ANFInfoWeb"
      description: "Informa la versión de la API y de ANFInfoWeb del servicio desplegado actualmente"
      operationId: "destinatarios_test"
      produces:
      - "application/json"
      responses:
        200:
          description: "Operación exitosa"
          schema:
            $ref: "#/definitions/Version"
        401:
          $ref: '#/responses/UnauthorizedError'
        500:
          $ref: '#/responses/InternalServerError'
  /admin/pending_tasks:
    get:
      tags:
      - "Admin"
      summary: "Devuelve el fichero x_pending_tasks.json"
      description: "Devuelve el fichero x_pending_tasks.json en el que se almacena los sitios que aún faltan por escanear en el escaner especificado por parámetros."
      operationId: "pending_tasks"
      produces:
      - "application/json"
      parameters:
      - name: "scanner"
        in: "query"
        description: "Escaner del que se desea consultar sus tareas pendientes. Puede tomar los valores infocif / empresite / economista."
        required: true
        type: "string"
      responses:
        200:
          description: "Operación exitosa"
          schema:
            type: "object"
        401:
          $ref: '#/responses/UnauthorizedError'
        500:
          $ref: '#/responses/InternalServerError'
  /admin/logs:
    get:
      tags:
      - "Admin"
      summary: "Devuelve un fichero de logs"
      description: "Realiza una búsqueda en la carpeta de logs y devuelve el archivo de logs que se corresponde con el día especificado."
      operationId: "GET/admin/logs"
      produces:
      - "text/plain"
      parameters:
      - name: "backward_days"
        in: "query"
        description: "A la fecha actual réstele este número y obtendrá la fecha del archivo de logs retornado."
        required: true
        type: "integer"
      responses:
        200:
          description: "Operación exitosa"
        400:
          description: "El archivo de logs requerido no existe."
        401:
          $ref: '#/responses/UnauthorizedError'
        500:
          $ref: '#/responses/InternalServerError'
    delete:
      tags:
      - "Admin"
      summary: "Vacía la carpeta de logs"
      description: "Realiza una búsqueda en la carpeta de logs elimina todos los archivos menos el del día actual."
      operationId: "DEL/admin/logs"
      produces:
      - "text/plain"
      responses:
        200:
          description: "Operación exitosa"
        401:
          $ref: '#/responses/UnauthorizedError'
        500:
          $ref: '#/responses/InternalServerError'
  /destinatarios/count:
    get:
      tags:
      - "Destinatarios"
      summary: "Devuelve la cantidad de empresas."
      description: "Devuelve la suma de la cantidad de empresas registradas en la base de datos."
      operationId: "GET/destinatarios/count"
      produces:
      - "application/json"
      responses:
        200:
          description: "Operación exitosa"
          schema:
            $ref: "#/definitions/DestinatariosCount"
        401:
          $ref: '#/responses/UnauthorizedError'
        404:
          description: "No existe en la base de datos ninguna empresa que cumpla con los criterios de busqueda"
        500:
          $ref: '#/responses/InternalServerError'
  /destinatario:
    get:
      tags:
      - "Destinatarios"
      summary: "Busca una empresa por su nombre"
      description: "Devuelve todos los datos de una empresa"
      operationId: "GET/destinatario"
      produces:
      - "application/json"
      parameters:
      - name: "name"
        in: "query"
        description: "nombre de la empresa por el que se va a realizar la búsqueda"
        required: true
        type: "string"
      responses:
        200:
          description: "Operación exitosa"
          schema:
            $ref: "#/definitions/Destinatario"
        401:
          $ref: '#/responses/UnauthorizedError'
        404:
          description: "No existe en la base de datos ninguna empresa que cumpla con los criterios de busqueda"
        409:
          description: "Se encontro en la base de datos mas de una empresa con el nombre consultado"
        500:
          $ref: '#/responses/InternalServerError'
  /destinatarios:
    get:
      tags:
      - "Destinatarios"
      summary: "Devuelve una lista de empresas"
      description: "Devuelve todos los datos de cada empresa listada. Se hace un select en la base de datos y se devuelve a partir de la empresa que coincida con {index} en la lista de empresas consultadas la cantidad de empresas indicadas en {count}. Es muy útil para mostrar empresas con paginado"
      operationId: "GET/destinatarios"
      produces:
      - "application/json"
      parameters:
      - name: "startindex"
        in: "query"
        description: "índice de la lista de empresas registradas a partir del cuál se van a devolver las empresas"
        required: true
        type: "integer"
        format: "int64"
      - name: "count"
        in: "query"
        description: "Cantidad de empresas que se van a devolver de la consulta"
        required: true
        type: "integer"
        format: "int32"
      responses:
        200:
          description: "Operación exitosa"
          schema:
            type: "array"
            items:
              $ref: "#/definitions/Destinatario"
        401:
          $ref: '#/responses/UnauthorizedError'
        404:
          description: "No existe en la base de datos ninguna empresa que cumpla con los criterios de busqueda"
        500:
          $ref: '#/responses/InternalServerError'
    put:
      tags:
      - "Destinatarios"
      summary: "Inserta un destinatario"
      description: "Inserta un destinatario dados sus datos menos los emails asociados a este. Para añadirle emails se debe ejcutar otra petición."
      operationId: "PUT/destinatarios"
      produces:
      - "application/json"
      parameters:
      - name: "destNombreEmpresa"
        in: "query"
        description: "Nombre de la empresa a insertar."
        required: true
        type: "string"
      - name: "destCIF"
        in: "query"
        description: "CIF/NIF de la empresa."
        required: false
        type: "string"
      - name: "destCantidadEmpleados"
        in: "query"
        description: "Cantidad de empleados de la empresa."
        required: false
        type: "integer"
        format: "int32"
      - name: "destVolumenVentas"
        in: "query"
        description: "Volumen de ventas de la empresa del último año registrado."
        required: false
        type: "integer"
        format: "int32"
      - name: "destActivoBalance"
        in: "query"
        description: "Balance de activos de la empresa."
        required: false
        type: "integer"
        format: "int32"
      - name: "destDireccion"
        in: "query"
        description: "Dirección de la empresa."
        required: false
        type: "string"
      - name: "destProvincia"
        in: "query"
        description: "Provincia/Comunidad Autónoma de la empresa."
        required: false
        type: "string"
      - name: "destPoblacion"
        in: "query"
        description: "Población/Municipio de la empresa."
        required: false
        type: "string"
      - name: "destWeb"
        in: "query"
        description: "Dirección web institucional de la empresa."
        required: false
        type: "string"
        format: "web"
      - name: "destTelefono"
        in: "query"
        description: "Número de teléfono de contacto de la empresa."
        required: false
        type: "string"
        format: "phone"
      - name: "destCNAE"
        in: "query"
        description: "Código CNAE correspondiente a la actividad económica principal que desarrolla la empresa."
        required: false
        type: "string"
      - name: "destObligacion"
        in: "query"
        description: "Si la cantidad de empleados es mayor que 100 o el volumen de ventas des mayor que 6010121.04 es true, en caso contrario es false."
        required: false
        type: "boolean"
      responses:
        200:
          description: "Operación exitosa"
        400:
          description: "Bad Request"
        401:
          $ref: '#/responses/UnauthorizedError'
        500:
          $ref: '#/responses/InternalServerError'
    delete:
      tags:
      - "Destinatarios"
      summary: "Elimina un destinatario"
      description: "Elimina un destinatario de la base de datos."
      operationId: "DEL/destinatarios"
      produces:
      - "application/json"
      parameters:
      - name: "destId"
        in: "query"
        description: "Id del destinatario en la base de datos."
        required: true
        type: "integer"
        format: "int32"
      responses:
        200:
          description: "Operación exitosa"
        400:
          description: "Bad Request"
        401:
          $ref: '#/responses/UnauthorizedError'
        500:
          $ref: '#/responses/InternalServerError'
  /emails/count:
    get:
      tags:
      - "Mails"
      summary: "Devuelve la cantidad de emails."
      description: "Devuelve la suma de la cantidad de emails registrados en la base de datos."
      operationId: "GET/emails/count"
      produces:
      - "application/json"
      responses:
        200:
          description: "Operación exitosa"
          schema:
            $ref: "#/definitions/EmailsCount"
        401:
          $ref: '#/responses/UnauthorizedError'
        500:
          $ref: '#/responses/InternalServerError'
  /emails:
    put:
      tags:
      - "Mails"
      summary: "Inserta un email"
      description: "Inserta un email asociado a un destinatario."
      operationId: "PUT/emails"
      produces:
      - "application/json"
      parameters:
      - name: "destEmail"
        in: "query"
        description: "Dirección de correo a insertar."
        required: true
        type: "string"
        format: "email"
      - name: "emailDepartamento"
        in: "query"
        description: "Departamento de la empresa al que pertenece el mail. Debe ser uno de estos: DPD, COMERCIAL o GENERAL."
        required: true
        type: "string"
      - name: "destId"
        in: "query"
        description: "Id del destinatario en la base de datos."
        required: true
        type: "integer"
        format: "int32"
      responses:
        200:
          description: "Operación exitosa"
        400:
          description: "Bad Request"
        401:
          $ref: '#/responses/UnauthorizedError'
        500:
          $ref: '#/responses/InternalServerError'
  /scanners/status:
    get:
      tags:
      - "Scanners"
      summary: "Informa el estado de cada Scanner"
      description: "Un Scanner puede estar IN_EXECUTION, COMPLETED, ABORTED, UNKNOWN"
      operationId: "PUT/scanners/status"
      produces:
      - "application/json"
      responses:
        200:
          description: "Operación exitosa"
          schema:
            type: "object"
            items:
              $ref: "#/definitions/ScannerStatus"
        401:
          $ref: '#/responses/UnauthorizedError'
        500:
          $ref: '#/responses/InternalServerError'
  /scanners/rankingeleconomista:
    put:
      tags:
      - "Scanners"
      summary: "Ejecuta el Scanner del sitio ..."
      description: ""
      operationId: "PUT/scanners/rankingeleconomista"
      produces:
      - "application/json"
      responses:
        202:
          description: "El Scanner está en ejecución"
        401:
          $ref: '#/responses/UnauthorizedError'
        409:
          description: "La solicitud no puede ser procesada pues actualmente un Scanner se encuentra en ejecucion"
        500:
          $ref: '#/responses/InternalServerError'
  /scanners/infocif:
    put:
      tags:
      - "Scanners"
      summary: "Ejecuta el Scanner del sitio ..."
      description: ""
      operationId: "PUT/scanners/infocif"
      produces:
      - "application/json"
      responses:
        202:
          description: "El Scanner está en ejecución"
        401:
          $ref: '#/responses/UnauthorizedError'
        409:
          description: "La solicitud no puede ser procesada pues actualmente un Scanner se encuentra en ejecucion"
        500:
          $ref: '#/responses/InternalServerError'
  /scanners/empresite:
    put:
      tags:
      - "Scanners"
      summary: "Ejecuta el Scanner del sitio ..."
      description: ""
      operationId: "PUT/scanners/empresite"
      produces:
      - "application/json"
      responses:
        202:
          description: "El Scanner está en ejecución"
        401:
          $ref: '#/responses/UnauthorizedError'
        409:
          description: "La solicitud no puede ser procesada pues actualmente un Scanner se encuentra en ejecucion"
        500:
          $ref: '#/responses/InternalServerError'
  /scanners/emails:
    put:
      tags:
      - "Scanners"
      summary: "Ejecuta el Scanner del sitio ..."
      description: ""
      operationId: "PUT/scanners/emails"
      produces:
      - "application/json"
      parameters:
      - name: "deeplevels"
        in: "query"
        description: "entero que representa la cantidad de pasos a seguir en la b'usqueda en profundidad por los diferentes sitios de las empresas en busca de emails"
        required: true
        type: "integer"
        format: "int64"
      responses:
        202:
          description: "El Scanner está en ejecución"
        401:
          $ref: '#/responses/UnauthorizedError'
        409:
          description: "La solicitud no puede ser procesada pues actualmente un Scanner se encuentra en ejecucion"
        500:
          $ref: '#/responses/InternalServerError'
definitions:
  ScannerStatus:
    type: "object"
    properties:
      EMPRESITE_SCANNER:
        type: "string"
        description: "Estado del Scanner del sitio https://empresite.eleconomista.es/"
        enum:
        - "IN_EXECUTION"
        - "COMPLETED"
        - "ABORTED"
        - "UNKNOWN"
      RANKINGELECONOMISTA_SCANNER:
        type: "string"
        description: "Estado del Scanner del sitio https://ranking-empresas.eleconomista.es/"
        enum:
        - "IN_EXECUTION"
        - "COMPLETED"
        - "ABORTED"
        - "UNKNOWN"
      EMAILS_SCANNER:
        type: "string"
        description: "Estado del Scanner que se encarga de buscar emails en el sitio web de la empresa"
        enum:
        - "IN_EXECUTION"
        - "COMPLETED"
        - "ABORTED"
        - "UNKNOWN"
      INFOCIF_SCANNER:
        type: "string"
        description: "Estado del Scanner del sitio http://www.infocif.es/"
        enum:
        - "IN_EXECUTION"
        - "COMPLETED"
        - "ABORTED"
        - "UNKNOWN"
    xml:
      name: "Scanner Status"
  Destinatario:
    type: "object"
    properties:
      destVolumenVentas:
        type: "integer"
        description: "Volumen de ventas del último año registrado"
        format: "int64"
      destWeb:
        type: "string"
        description: "Stio web principal de la empresa"
        format: "web"
      destObligacion:
        type: "boolean"
        description: "Obligación ... Sólo es true si la cantidad de empleados es mayor que 100 o el volumen de ventas es mayor que 6010121.04"
        default: false
      destCNAELiteral:
        type: "string"
        description: "Descripcion literal de la clasificación CNAE de la empresa"
      destCantidadEmpleados:
        type: "integer"
        description: "Cantidad de empleados de la empresa"
        format: "int32"
      destCIF:
        type: "string"
        description: "Código de Identificación Fiscal de la empresa"
      destProvincia:
        type: "string"
        description: "Provincia dónde se encuentra la sede principal de la empresa"
      emails:
        type: "array"
        description: "Arreglo de emails de una empresa"
        items:
          $ref: "#/definitions/Email"
      destId:
        type: "integer"
        description: "id de la empresa en la base de datos"
        format: "int64"
      destTelefono:
        type: "integer"
        description: "Teléfono principal de la empresa"
        format: "int32"
      destActivoBalance:
        type: "integer"
        description: "........."
        format: "int64"
      destPoblacion:
        type: "string"
        description: "Municipio dónde se encuentra registrada la sede principal de la empresa"
      destNombreEmpresa:
        type: "string"
        description: "Nombre de la empresa"
      destCNAE:
        type: "string"
        description: "Código que representa la Clasificación Nacional de Actividades Económicas de España que describe a la empresa"
      destDireccion:
        type: "string"
        description: "Dirección dónde se encuetra registrada la sede principal de la empresa"
    xml:
      name: "Destinatario"
  DestinatariosCount:
    type: "object"
    properties:
      Destinatarios_Count:
        type: "integer"
        description: "cantidad de empresas registradas en la base de datos"
        format: "int64"
  Email:
    type: "object"
    properties:
      destId:
        type: "integer"
        description: "id del Destinatario al que pertenece este email en la base de datos"
        format: "int64"
      emailDestId:
        type: "integer"
        description: "id de este email en la base de datos"
        format: "int64"
      destEmail:
        type: "string"
        description: "dirección email"
        format: "mail"
      emailDepartamento:
        type: "string"
        description: "Departamento al que hace referencia el email"
        enum:
        - "DPD"
        - "COMERCIAL"
        - "GENERAL"
    xml:
      name: "Email"
  Version:
    type: "object"
    properties:
      Api Version:
        type: "string"
        description: "Versión de API Destinatarios"
      ANFInfoWeb Version:
        type: "string"
        description: "versión de ANFInfoWeb"
    xml:
      name: "Version"
  EmailsCount:
    type: "object"
    properties:
      Emails_Count:
        type: "integer"
        description: "cantidad de emails registrados en la base de datos"
        format: "int64"
responses:
  UnauthorizedError:
    description: Authentication information is missing or invalid
    headers:
      WWW_Authenticate:
        type: string
  InternalServerError:
    description: "Internal Server Error: Error desconocido en el procesamiento de la peticion HTTP. La causa de este error puede originarse en el servidor. En el mensaje de respuesta se dan detalles."
#externalDocs:
#  description: "Find out more about Swagger"
#  url: "http://swagger.io"